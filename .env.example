# ===================================
# 多分店匯款管理系統 - 環境變數設定
# ===================================

# 🔧 伺服器設定
PORT=3000
NODE_ENV=development

# 📊 資料庫設定
# 使用 SQLite 資料庫（生產環境建議使用 PostgreSQL）
DATABASE_URL=sqlite:./database.sqlite

# 切換到 PostgreSQL（可選）
# USE_PG=false
# PG_HOST=localhost
# PG_PORT=5432
# PG_DATABASE=payment_system
# PG_USERNAME=postgres
# PG_PASSWORD=your-password

# 👨‍💼 管理員帳戶設定
# ⚠️ 【必須修改】上線前務必更改這些預設值！系統會在啟動時驗證
ADMIN_USERNAME=admin

# 首次創建管理員時使用的密碼（僅首次部署需要）
# 創建後，資料庫密碼為唯一真實來源，請透過管理後台或 CLI 工具修改密碼
ADMIN_PASSWORD=請使用強密碼包含大小寫數字特殊字符

# 注意：你也可以使用 bcrypt hash 代替明文密碼（更安全）
# 生成 hash 的方法：node -e "console.log(require('bcryptjs').hashSync('你的密碼', 10))"
# ADMIN_PASSWORD_HASH=$2b$10$...

# 🔄 緊急密碼重置（v3.1 新功能）
# ⚠️ 僅在忘記密碼且無法登入時使用！
# 設定為 true 會在伺服器啟動時強制重置密碼為 .env 的 ADMIN_PASSWORD
# 重置後請立即設回 false 避免意外覆蓋
FORCE_RESET_ADMIN_PASSWORD=false

# 💡 正常的密碼重置方式（推薦）：
#    1. 使用 CLI 工具：cd backend && npm run reset-password
#    2. 在管理後台的「會員管理」中修改密碼

# 🔐 安全性設定（v2.0 強化版）
# ⚠️ 【必須修改】JWT_SECRET 必須至少 32 字元！系統會在啟動時強制驗證
# 生成強密鑰的方法：
# Linux/Mac: openssl rand -hex 32
# Node.js: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
JWT_SECRET=請使用至少32字元的隨機字符串如openssl-rand-hex-32

# 🌐 CORS 設定
# 開發環境可以使用 localhost，生產環境必須設定實際域名
CORS_ORIGIN=http://localhost:5173,https://your-production-domain.com

# 🍪 Cookie 設定（VPS 部署必填）
# 如果前後端在不同子域名（如 app.swair.online 和 api.swair.online）
# 需要設定共享的父域名，讓 Cookie 可以跨子域名使用
# 範例：COOKIE_DOMAIN=.swair.online （注意前面的點）
# 開發環境不需要設定，留空即可
# COOKIE_DOMAIN=

# 🛡️ 安全性選項（v3.0 更新）
# 全局速率限制（15 分鐘內最多請求次數）
RATE_LIMIT_MAX=500

# 登入速率限制（15 分鐘內最多登入嘗試次數）
LOGIN_RATE_LIMIT_MAX=5

# API 速率限制（1 分鐘內最多 API 請求次數）
API_RATE_LIMIT_MAX=100

# 📦 快取設定
# 快取存活時間（秒）
CACHE_TTL=300

# 🗄️ 資料庫設定
# 單次查詢最大筆數限制（防止記憶體溢出）
MAX_QUERY_LIMIT=1000

# IP 白名單 (可選，用逗號分隔 CIDR 格式)
# IP_WHITELIST=192.168.1.0/24,10.0.0.0/8

# 🚨 監控設定 (可選)
# WEBHOOK_URL=https://your-monitoring-webhook.com
# LOG_LEVEL=info

# 📱 通知設定 (可選 - Discord/Slack 整合)
# DISCORD_BOT_TOKEN=your-discord-bot-token
# DISCORD_CHANNEL_ID=your-discord-channel-id
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# ===================================
# 🚀 v2.0 新功能說明
# ===================================
# 1. 環境變數強制驗證：啟動時自動檢查 JWT_SECRET、管理員密碼強度
# 2. CSRF 保護升級：雙重提交 Cookie 模式（自動處理，無需額外配置）
# 3. 資料庫索引優化：自動創建 20+ 個索引（無需手動操作）
# 4. HTTP 壓縮：自動啟用 Gzip/Deflate（提升 70-80% 傳輸效率）
# 5. 安全標頭：自動設定 CSP、HSTS、X-Frame-Options 等

# ===================================
# ⚠️ 生產環境部署檢查清單（v2.0）
# ===================================
# 【Critical - 必做】
# ✅ 修改 JWT_SECRET（至少 32 字元隨機字符串）
# ✅ 修改管理員密碼（強密碼：大小寫+數字+特殊字符）
# ✅ 設定正確的 CORS_ORIGIN（生產域名，移除 localhost）
# ✅ 檢查 NODE_ENV=production

# 【High Priority - 強烈建議】
# ✅ 配置 HTTPS (建議使用 Let's Encrypt 免費證書)
# ✅ 定期備份 SQLite 資料庫（建議每日自動備份）
# ✅ 設定防火牆規則（僅開放 80/443 端口）
# ✅ 配置監控和日誌（推薦使用 PM2 + 日誌服務）

# 【Medium Priority - 建議】
# ✅ 設定 IP 白名單（如果只允許特定 IP 存取）
# ✅ 調整速率限制（根據實際流量調整）
# ✅ 啟用審計日誌檢查（定期檢視可疑活動）

# ===================================
# 📖 說明文件
# ===================================
# 完整文件請參考：README.md
# 問題排查請參考：TROUBLESHOOTING.md
# 安全性指南請參考：SECURITY.md

# ===================================
# 🔧 快速測試配置（僅供開發測試）
# ===================================
# 如果只是想快速測試系統，可以使用以下配置：
# JWT_SECRET=test-jwt-secret-32-chars-minimum-required-here
# ADMIN_PASSWORD=Admin@123456
# 注意：絕對不要在生產環境使用測試配置！